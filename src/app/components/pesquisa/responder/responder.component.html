<div class="container">
  <div class="content">
    <ng-container *ngIf="loading; else formTemplate">
      <div
        style="width: 100%; display: flex; flex-direction: column; gap: 1rem"
      >
        <div
          style="
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
          "
        >
          <p-skeleton width="50%" height="2rem" styleClass="mb-2"></p-skeleton>
          <p-skeleton
            width="80%"
            height="1.5rem"
            styleClass="mb-4"
          ></p-skeleton>
        </div>

        <div
          style="
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
          "
        >
          <p-skeleton
            width="30%"
            height="1.5rem"
            styleClass="mb-2"
          ></p-skeleton>
          <p-skeleton width="100%" height="6rem" styleClass="mb-4"></p-skeleton>
        </div>

        <p-skeleton height="2rem" width="80%"></p-skeleton>

        <div
          style="
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
          "
        >
          <p-skeleton
            width="100%"
            height="3rem"
            styleClass="mb-4"
            *ngFor="let _ of [1, 2, 3]"
          ></p-skeleton>
        </div>

        <div
          *ngFor="let _ of [1, 2]"
          style="
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
          "
        >
          <p-skeleton
            width="40%"
            height="1.5rem"
            styleClass="mb-2"
          ></p-skeleton>
          <p-skeleton width="100%" height="4rem" styleClass="mb-4"></p-skeleton>
        </div>

        <div
          *ngFor="let _ of [1, 2]"
          style="
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
          "
        >
          <p-skeleton
            width="40%"
            height="1.5rem"
            styleClass="mb-2"
          ></p-skeleton>
          <p-skeleton width="100%" height="4rem" styleClass="mb-4"></p-skeleton>
        </div>
      </div>
    </ng-container>

    <ng-template #formTemplate>
      <form *ngIf="form" [formGroup]="form" (ngSubmit)="onSubmit()">
        <div class="pergunta-item">
          <h2 class="titulo">Pesquisa de Satisfação</h2>
          <p class="descricao">
            Sua opinião é muito importante para nós! Por favor, responda as
            perguntas abaixo.
          </p>
        </div>

        <div class="pergunta-item">
          <h3 class="titulo">Selecione sua Área</h3>
          <p-divider class="divider"></p-divider>
          <p-listbox
            [options]="areas"
            formControlName="area"
            [(ngModel)]="selectedArea"
            [multiple]="false"
            [optionLabel]="'nome'"
            [style]="{ width: '100%' }"
          ></p-listbox>
        </div>

        <div class="form-row">
          <div>
            <h3 class="categoria-titulo">Qual sua idade</h3>
            <p-divider class="divider"></p-divider>
            <input
              type="number"
              class="input-idade"
              formControlName="idade"
              pInputText
              placeholder="Digite sua idade"
              style="width: 100%"
            />
          </div>

          <div>
            <h3 class="categoria-titulo">Sexo</h3>
            <p-divider class="divider"></p-divider>
            <p-dropdown
              [options]="sexoOptions"
              optionLabel="label"
              optionValue="value"
              placeholder="Selecione seu sexo"
              formControlName="sexo"
              styleClass="input-sexo"
            ></p-dropdown>
          </div>

          <div>
            <h3 class="categoria-titulo">Gênero</h3>
            <p-divider class="divider"></p-divider>
            <p-dropdown
              [options]="generoOptions"
              optionLabel="label"
              optionValue="value"
              placeholder="Selecione seu gênero"
              formControlName="genero"
              styleClass="input-sexo"
            >
              <ng-template let-option pTemplate="item">
                <div [title]="option.tooltip">
                  {{ option.label }}
                </div>
              </ng-template>
            </p-dropdown>
          </div>
        </div>

        <div
          *ngFor="let categoria of categorias; let i = index"
          class="pergunta-item"
        >
          <h3 class="categoria-titulo">{{ categoria.nome }}</h3>
          <p-divider class="divider"></p-divider>

          <div
            *ngFor="let pergunta of categoria.perguntas; let j = index"
            class="pergunta-block"
          >
            <label class="pergunta-label">{{ pergunta.pergunta }}</label>

            <!-- PERGUNTAS OBJETIVAS -->
            <div *ngIf="pergunta.descritiva == 0" class="opcoes-grid">
              <div *ngFor="let opcao of escala" class="opcao-radio">
                <p-radioButton
                  [value]="opcao.value"
                  [formControl]="getFormControl(getIndex(i, j))"
                  name="pergunta-{{ i }}-{{ j }}"
                  [inputId]="'pergunta-' + i + '-' + j + '-' + opcao.value"
                ></p-radioButton>
                <label
                  [for]="'pergunta-' + i + '-' + j + '-' + opcao.value"
                  class="opcao-label"
                >
                  {{ opcao.label }}
                </label>
              </div>
            </div>

            <!-- PERGUNTAS DESCRITIVAS -->
            <div *ngIf="pergunta.descritiva == 1" class="opcao-textarea">
              <textarea
                [formControl]="getFormControl(getIndex(i, j))"
                formControlName="texto"
                class="input-textarea"
                placeholder="Digite sua resposta"
                rows="3"
                pInputTextarea
                style="width: 100%"
              ></textarea>
            </div>
          </div>
        </div>
        <div
          style="
            width: 100%;
            display: flex;
            justify-content: flex-end;
            margin-top: 1rem;
            padding-bottom: 1rem;
          "
        >
          <button
            pButton
            severity="primary"
            [outlined]="true"
            type="submit"
            label="Enviar Resposta"
          ></button>
        </div>
      </form>
    </ng-template>
  </div>
</div>
<p-toast></p-toast>
<app-modal-boas-vindas></app-modal-boas-vindas>
